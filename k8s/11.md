# Task 1
Creating and checking secret
```bash
$: kubectl create secret generic lab11-secret --from-literal=username=admin --from-literal=password='qwerty'

secret/lab11-secret created
```

```bash
$: kubectl get secrets

NAME                                                  TYPE                 DATA   AGE
lab11-secret                                          Opaque               2      39s
sh.helm.release.v1.my-app-with-hooks-helm-python.v1   helm.sh/release.v1   1      5d13h
```

```bash
$: kubectl describe secret lab11-secret

Name:         lab11-secret
Namespace:    default
Labels:       <none>
Annotations:  <none>

Type:  Opaque

Data
====
password:  6 bytes
username:  5 bytes
```
Decoding the secret:

```bash
$: kubectl get secret lab11-secret -o jsonpath='{.data}'

{"password":"cXdlcnR5","username":"YWRtaW4="}
```
```bash
$: echo 'cXdlcnR5' | base64 --decode
qwerty
```
```bash
$: echo 'YWRtaW4=' | base64 --decode
admin
```
### Manage secreets with Helm
Create secrets with PGP and get get its fingerprint:
```bash
$: pgp --gen-key
...
$: pgp --list-keys
...
```

$PGP_FINGERPRINT is our fingerprint 
```bash
$: sops -p $PGP_FINGERPRINT my-app/secrets.yaml #Inside secrets.yaml: password: qwerty
```
```bash
$: helm secrets install my-helm-app-with-secrets my-app -f ./my-app/secrets.yaml --values my-app/values.yaml
```
```bash
$: kubectl get po
NAME                                               READY   STATUS    RESTARTS   AGE
my-helm-app-with-secrets-my-app-756c7b4bd6-9bxfb   1/1     Running   0          82s

$: kubectl exec my-helm-app-with-secrets-my-app-756c7b4bd6-9bxfb -- printenv | grep MY_PASS
MY_PASSWORD=qwerty
```
# Task 2

```bash
kubectl get pods

NAME                                               READY   STATUS    RESTARTS   AGE
my-helm-app-with-secrets-my-app-756c7b4bd6-9bxfb   2/2     Running   0          58s
vault-0                                            1/1     Running   0          113s
vault-agent-injector-dbfc5cd77-dg526               1/1     Running   0          113s
```

```bash

$ kubectl exec -it my-helm-app-with-secrets-my-app-756c7b4bd6-9bxfb -- sh
Defaulted container "helm-app-python" out of: helm-app-python, vault-agent, vault-agent-init (init)

# Inside pod
/app_python $ cat /vault/secrets/database-config.txt
data: map[password:db-secret-password username:db-readonly-username]
metadata: map[created_time:2024-04-16T09:33:39.993151672Z custom_metadata:<nil> deletion_time: destroyed:false version:1]

/app_python $ df -h
Filesystem                Size      Used Available Use% Mounted on
overlay                  58.4G     19.4G     36.0G  56% /
tmpfs                    64.0M         0     64.0M   0% /dev
tmpfs                     7.6G      4.0K      7.6G   0% /vault/secrets
/dev/vda1                58.4G     19.4G     36.0G  56% /dev/termination-log
/dev/vda1                58.4G     19.4G     36.0G  56% /etc/resolv.conf
/dev/vda1                58.4G     19.4G     36.0G  56% /etc/hostname
/dev/vda1                58.4G     19.4G     36.0G  56% /etc/hosts
shm                      64.0M         0     64.0M   0% /dev/shm
tmpfs                     7.6G     12.0K      7.6G   0% /run/secrets/kubernetes.io/serviceaccount
tmpfs                    64.0M         0     64.0M   0% /proc/kcore
tmpfs                    64.0M         0     64.0M   0% /proc/keys
tmpfs                    64.0M         0     64.0M   0% /proc/timer_list
tmpfs                     3.8G         0      3.8G   0% /sys/firmware
```
```
